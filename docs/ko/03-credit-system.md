# InfoMesh — 크레딧 시스템

---

## 1. 개요

크레딧은 피어별 로컬 추적 — 블록체인 불필요.

기여 = 크롤링 + 인덱스 호스팅 + 쿼리 처리 + LLM 요약  
보상 = 검색 API 사용 쿼터

```
┌──────────────────────────────────────┐
│  기여 없이 검색만? → 속도 제한       │
│  크롤링 기여?      → 충분한 검색     │
│  많이 기여?        → 우선 응답       │
│  LLM 요약 기여?    → 추가 보너스     │
└──────────────────────────────────────┘
```

로컬에서 이웃 피어들과 크레딧 교환 → 글로벌 합의 불필요.

---

## 2. 일반화 공식

```
C_earned = Σ (W_i × Q_i × M_i)
```

- `W_i` = 행동 유형 `i`의 자원 가중치 (자원 비용에 비례하여 정규화)
- `Q_i` = 수행 수량
- `M_i` = 시간 배율 (기본 1.0; 심야 LLM 작업 시 1.5)

---

## 3. 자원 가중치

가중치는 **크롤링 = 1.0**을 기준 단위로 정규화.  
모든 가중치는 대략적인 상대 자원 비용(CPU, 대역폭, 저장공간)을 반영.

| 행동 | 가중치 (W) | 카테고리 | 근거 |
|------|-----------|---------|------|
| 크롤링 | **1.0** /페이지 | 기본 | 기준 단위: CPU + 대역폭 + 파싱 |
| 쿼리 처리 | **0.5** /쿼리 | 기본 | 크롤링보다 자원 소모 적음 |
| 문서 호스팅 | **0.1** /시간 | 기본 | 수동적 저장공간 + 대역폭 |
| 네트워크 가동 | **0.5** /시간 | 기본 | 네트워크 가용성 가치 |
| LLM 요약 (자체) | **1.5** /페이지 | LLM | 높은 연산 비용, 지배적이지 않게 상한 설정 |
| LLM 요청 처리 (피어용) | **2.0** /요청 | LLM | 타인 기여, 네트워크 가치 높음 |
| Git PR — 문서/타이포 | **1,000** /머지된 PR | 보너스 | 문서 또는 타이포 수정 |
| Git PR — 버그 수정 | **10,000** /머지된 PR | 보너스 | 테스트 포함 버그 수정 |
| Git PR — 기능 추가 | **50,000** /머지된 PR | 보너스 | 새로운 기능 구현 |
| Git PR — 핵심/아키텍처 | **100,000** /머지된 PR | 보너스 | 핵심 아키텍처 또는 대규모 기능 |

---

## 4. 시간 배율 (M)

| 조건 | 배율 | 적용 대상 |
|------|------|----------|
| 일반 시간대, 기본 행동 | `M = 1.0` | 항상 |
| 일반 시간대, LLM 행동 | `M = 1.0` | LLM |
| **심야 시간대, LLM 행동** | **`M = 1.5`** | LLM만 |

- 심야 시간대는 노드별 설정 (기본값: 현지 시간 23:00–07:00)
- 기본(Base) 행동에는 시간 배율이 적용되지 않음 — LLM 보너스가 비 LLM 노드에 불이익 주지 않음
- 네트워크는 일괄 요약 요청을 현재 심야 시간대인 노드에 우선 라우팅

### 심야 시간 남용 방지

| 위험 | 완화 |
|------|------|
| 시간대 조작 | IP 지오로케이션 교차 확인 (±2시간 허용); 불일치 → M=1.0 강제 |
| VPN 시간대 위장 | IP 지오로케이션 불확실 시 최대 배율 감소 (1.5x 대신 1.3x) |
| 시계 조작 | 노드 보고 시간과 네트워크 중앙값 비교; >2시간 편차 → 플래그 |

---

## 5. 검색 비용

```
C_search = 0.1 / tier(contribution_score)
```

기여할수록 검색이 저렴해지는 구조:

| 티어 | 기여 점수 | 검색 비용 | 설명 |
|------|----------|----------|------|
| 1 | < 100 | 0.100 | 신규 / 낮은 기여자 |
| 2 | 100 – 999 | 0.050 | 중간 기여자 |
| 3 | ≥ 1000 | 0.033 | 높은 기여자 |

---

## 6. 공정성 보장

### 비 LLM 노드 보호

**크롤링만 하는 노드** (LLM 없음)가 시간당 10페이지를 크롤링하면:

```
시간당 크레딧 = (1.0 × 10 × 1.0) + (0.5 × 1 × 1.0) = 10.5 크레딧/시간
                 크롤링               가동시간

검색 가능 횟수 = 10.5 / 0.1 = 105회/시간 (최악 티어)
                 10.5 / 0.033 = 318회/시간 (최고 티어)
```

→ LLM 없이도 **충분한 검색**이 가능.

### Git 기여 예시

InfoMesh 레포에 버그 수정 PR을 머지한 기여자:

```
Git 크레딧 = 10,000 × 1 × 1.0 = 10,000 크레딧 (보너스, M 항상 1.0)
검색 가능 = 10,000 / 0.1 = 100,000회 (최악 티어)
           10,000 / 0.033 = 303,030회 (최고 티어)
```

| PR 유형 | 크레딧 | 검색 (티어 1) | 검색 (티어 3) |
|---------|---------|-------------|-------------|
| 문서/타이포 | 1,000 | 10,000 | 30,303 |
| 버그 수정 | 10,000 | 100,000 | 303,030 |
| 기능 추가 | 50,000 | 500,000 | 1,515,151 |
| 핵심/아키텍처 | 100,000 | 1,000,000 | 3,030,303 |

> Git 기여 크레딧은 머지된 PR당 **일회성 보너스**입니다. 지속적인 크롤링/가동시간 크레딧과 합산됩니다.
> PR 유형은 관리자가 머지 시 라벨로 결정합니다.

### 기여 점수 누적

`contribution_score`가 검색 비용 티어를 결정합니다. **노드 생성 이후 모든 크레딧의 누적 합계**입니다:

```
contribution_score = Σ (노드 생성 이후 모든 C_earned)
```

| 이정표 | 달성 방법 | 예상 시간 |
|--------|----------|----------|
| 티어 1 → 티어 2 (100) | 100 페이지 크롤링 | 10 pages/hr로 ~10시간 |
| 티어 2 → 티어 3 (1000) | 1000 페이지 크롤링 | 10 pages/hr로 ~4일 |
| 빠른 달성 | 문서 PR 1개 + 80 페이지 크롤링 | 1,000 + 80 = 1,080 → 티어 3 즉시 달성 |

### LLM 가중치 상한

LLM 관련 수입이 노드 전체 크레딧의 ~60%를 넘지 않도록 설계:

```
크롤링 10페이지 + LLM 요약 10페이지일 경우:
  기본 크레딧: 10.0 + 0.5 = 10.5
  LLM 크레딧: 15.0
  LLM 비율: 15.0 / 25.5 = 58.8% ← 상한 이내
```

> LLM은 네트워크를 위한 **보너스**이지 참여 **필수 조건**이 아닙니다.

### 설계 원칙 요약

| 원칙 | 구현 |
|------|------|
| 정규화 | 크롤링 = 1.0 기준, 자원 비용에 비례 |
| LLM 상한 | LLM 수입 ≤ 60% |
| 비 LLM 보호 | 크롤링만으로 시간당 100회+ 검색 가능 |
| 심야 보너스 | 시간 배율(M)로 LLM에만 적용, 기본 행동 무영향 |
| 가동 보상 | 하드웨어 무관하게 상시 접속 보상 |
| 무임승차 방지 | 순 크레딧 음수 시 속도 제한 |
| 기여 우대 | 기여 점수 높을수록 신뢰도 + 라우팅 우선권 |
| 크레딧 파밍 방어 | 신규 노드 수습 기간 + 통계적 이상 탐지 ([신뢰 & 무결성](07-trust-integrity.md#54-크레딧-파밍-방지) 참조) |
| `crawl_url()` 속도 제한 | 노드당 60 URL/시간, 도메인당 10개 대기열, 최대 depth=3 |

---

*관련 문서: [개요](01-overview.md) · [아키텍처](02-architecture.md) · [기술 스택](04-tech-stack.md) · [법적 고려사항](06-legal.md) · [신뢰 & 무결성](07-trust-integrity.md) · [보안 감사](08-security-audit.md) · [콘솔 대시보드](09-console-dashboard.md) · [MCP 연동](10-mcp-integration.md) · [배포](11-publishing.md) · [FAQ](12-faq.md)*
